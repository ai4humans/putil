#!/usr/bin/env python
# get-site-packages-dir.py
# Copyright (c) 2013-2015 Pablo Acosta-Serafini
# See LICENSE for details
# pylint: disable=C0111,C0103

from __future__ import print_function
import distutils.sysconfig, os, sys, subprocess


def main_alt2(version):
    """
    Find location of python${version}/site-packages/ directory with
    shell command find
    """
    pobj = subprocess.Popen(
        ['find', os.sep, '-name', 'pcontracts.py'],
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE
    )
    stdout, _ = pobj.communicate()
    out = (
        stdout.split('\n')
        if sys.version_info.major == 2 else
        stdout.decode('ascii').split('\n')
    )
    dirs = []
    for line in out:
        if os.path.join(
                'python{0}'.format(version),
                'site-packages',
                'putil') in line:
            dirs.append(line)
    if not dirs:
        raise RuntimeError('Python site-packages directory could not be found')
    if len(dirs) > 2:
        raise RuntimeError(
            'More than two possible Python site-packages directories'
        )
    site_pkg_dir = dirs[0]
    print(site_pkg_dir)


def main_alt1(version):
    """
    Find location of python${version}/site-packages/ directory with
    Python module
    """
    site_pkg_dir = distutils.sysconfig.get_python_lib()
    if 'python{0}'.format(version) not in site_pkg_dir:
        raise RuntimeError(
            'Python site-packages directory could not be found, got {0}'.format(
                site_pkg_dir
            ))
    print(site_pkg_dir)


def main():
    """
    Find location of python${version}/site-packages/ directory with
    Python module
    """
    print(distutils.sysconfig.get_python_lib())
    print(sys.path)
    mdir = ''
    for mdir in sys.path:
        print('***********************************')
        print(mdir)
        try:
            print(os.listdir(mdir))
        except:
            pass
        if os.path.exists(os.path.join(mdir, 'putil')):
            break
    else:
        raise RuntimeError('Python site-packages directory could not be found')
    print(mdir)


if __name__ == '__main__':
    main()
